{% load static %}
<!doctype html>
<html lang="en">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <title>{% block title %}ePOS System{% endblock %}</title>
    <!-- <link rel="icon" href="{% static 'img/ushe-2.png' %}"> -->
    <script>
      // Set initial Bootstrap theme before CSS loads to avoid flash
      (function() {
        try {
          const stored = localStorage.getItem('theme');
          const prefersDark = window.matchMedia && window.matchMedia('(prefers-color-scheme: dark)').matches;
          const theme = stored || (prefersDark ? 'dark' : 'light');
          const resolved = theme === 'auto' ? (prefersDark ? 'dark' : 'light') : theme;
          document.documentElement.setAttribute('data-bs-theme', resolved);
        } catch (e) {
          document.documentElement.setAttribute('data-bs-theme', 'light');
        }
      })();
    </script>
    <link rel="stylesheet" type="text/css" href="{% static 'bootstrap-5.3.7-dist/css/bootstrap.min.css' %}">
    {% block extra_head %}{% endblock %}
  </head>
  <body>
  {% include 'manage_orders/navbar.html' %}
    <div class="container-fluid px-3">
      {% block content %}{% endblock %}
    </div>
    <script src="{% static 'bootstrap-5.3.7-dist/js/bootstrap.bundle.min.js' %}"></script>
    <!-- Universal Ripple Effect -->
    <script src="{% static 'js/ripple.js' %}"></script>
    <script>
      // Global theme toggle logic (light/dark/auto)
      (function(){
        const mq = window.matchMedia ? window.matchMedia('(prefers-color-scheme: dark)') : null;
        const getPreferred = () => {
          const s = localStorage.getItem('theme');
          if (s) return s;
          return 'auto';
        };
        const applyTheme = (t) => {
          if (t === 'auto') {
            const dark = mq && mq.matches;
            document.documentElement.setAttribute('data-bs-theme', dark ? 'dark' : 'light');
          } else {
            document.documentElement.setAttribute('data-bs-theme', t);
          }
        };
        // React to OS changes when auto
        if (mq && mq.addEventListener) {
          mq.addEventListener('change', () => {
            if ((localStorage.getItem('theme') || 'auto') === 'auto') applyTheme('auto');
          });
        }
        window.addEventListener('DOMContentLoaded', () => {
          // Initialize active state
          const current = getPreferred();
          applyTheme(current);
          document.querySelectorAll('[data-theme-value]').forEach(btn => {
            const val = btn.getAttribute('data-theme-value');
            if (val === current) btn.classList.add('active');
            btn.addEventListener('click', () => {
              document.querySelectorAll('[data-theme-value]').forEach(b => b.classList.remove('active'));
              btn.classList.add('active');
              localStorage.setItem('theme', val);
              applyTheme(val);
            });
          });
        });
      })();
    </script>
    {% block extra_js %}{% endblock %}
  </body>
</html>